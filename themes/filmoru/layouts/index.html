{{ define "main" }}
<!-- Edition Banner - 21:9 Minimal -->
<section class="edition-banner">
  <!-- Left: Title + Headlines -->
  <div class="banner-content">
    <div class="banner-titles">
      <div class="banner-edition">2935.{{ now.YearDay | printf "%03d" }}</div>
      <h1 class="banner-title-main">カセット・フューチャー</h1>
      <div class="banner-subtitle">CASSETTE FUTURE MAGAZINE</div>
    </div>

    <!-- Headlines (from today's issue) -->
    {{ $issueNum := printf "2935.%03d" now.YearDay }}
    {{ $issueArticles := where (where .Site.RegularPages "Section" "posts") ".Params.issue_number" $issueNum }}
    {{ if not $issueArticles }}
      {{ $issueArticles = first 3 (where .Site.RegularPages "Section" "posts") }}
    {{ end }}
    <div class="banner-headlines">
      {{ range first 3 $issueArticles }}
      <a href="{{ .RelPermalink }}" class="banner-headline">{{ .Title }}</a>
      {{ end }}
    </div>
  </div>

  <!-- Right: Cosmogirl preview -->
  {{ with (index (where .Site.RegularPages "Section" "cosmogirls") 0) }}
  <a href="{{ .RelPermalink }}" class="banner-cosmogirl">
    {{ with .Params.featured_image }}
    <img src="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" . }}" alt="Cosmogirl of the Week">
    {{ end }}
    <span class="cosmogirl-label">今週のコスモガール</span>
    <span class="cosmogirl-name">Cosmogirl of the Week: {{ .Params.name }}</span>
  </a>
  {{ end }}

  <!-- Footer bar -->
  <div class="banner-footer">
    銀河通信 • CASSETTE FUTURE • 2935.{{ now.YearDay | printf "%03d" }}
  </div>
</section>

  <!-- Section Divider -->
  <div class="section-divider">
    <span class="divider-line divider-blue"></span>
    <span class="divider-line divider-orange"></span>
    <span class="divider-line divider-yellow"></span>
  </div>

  <!-- Recent Articles (filtered to today's issue) -->
  {{ $todayIssue := printf "2935.%03d" now.YearDay }}
  <section class="mt-xl">
    <h2 class="section-title">最新記事</h2>
    {{ $todayArticles := where (where .Site.RegularPages "Section" "posts") ".Params.issue_number" $todayIssue }}
    {{ if not $todayArticles }}
      {{ $todayArticles = first 5 (where .Site.RegularPages "Section" "posts") }}
    {{ end }}
    {{ range $todayArticles }}
      <article class="article-card">
        <div class="article-jp-header">
          {{ .Params.title_jp | default "記事" }}
        </div>
        <div class="article-content">
          <h3 class="article-title">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h3>
          {{ with .Params.subtitle_jp }}
          <div class="article-subtitle">{{ . }}</div>
          {{ end }}
          <p class="article-excerpt">{{ .Summary | truncate 200 }}</p>
        </div>
        <div class="article-meta">
          <div class="article-journalist">{{ .Params.journalist | default "Staff" }}</div>
          <div class="article-date">{{ .Params.year | default "2935" }}.{{ .Date.YearDay | printf "%03d" }}</div>
        </div>
      </article>
    {{ end }}
  </section>

  <!-- Subscribe Box -->
  <section class="subscribe-box">
    <div class="subscribe-box-inner">
      <div class="subscribe-box-text">
        <span class="subscribe-jp">週刊配信</span>
        <span class="subscribe-en">Get weekly transmissions</span>
      </div>
      <div class="subscribe-box-form">
        <div class="ml-embedded" data-form="v4bk2z"></div>
      </div>
    </div>
  </section>

  <!-- Letters to the Editor -->
  <section class="letters-box">
    <div class="letters-box-inner">
      <div class="letters-icon">✉</div>
      <div class="letters-content">
        <span class="letters-jp">読者投稿</span>
        <span class="letters-title">Letters to the Editor</span>
        <p class="letters-desc">Got something to say? Complaints about coverage? Tips from the outer rim? We read everything.</p>
        <a href="mailto:letters@anarchygames.org" class="letters-link">letters@anarchygames.org</a>
      </div>
    </div>
  </section>

<style>
.subscribe-box {
  margin-top: var(--space-xl);
  padding: var(--space-xl) 0;
  border-top: 2px solid var(--border);
  border-bottom: 2px solid var(--border);
  text-align: center;
}

.subscribe-box-inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-lg);
}

.subscribe-box-text {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.subscribe-jp {
  font-family: var(--font-jp);
  font-size: 1.4rem;
  font-weight: 700;
}

.subscribe-en {
  font-size: 0.9rem;
  color: var(--text-light);
}

.subscribe-box-form {
  width: 100%;
  max-width: 450px;
}

/* Override Mailerlite default styles */
.subscribe-box .ml-embedded {
  margin: 0;
}

.subscribe-box .ml-form-embedWrapper {
  max-width: 100% !important;
}

.subscribe-box .ml-form-embedBody {
  padding: 0 !important;
}

.subscribe-box .ml-form-fieldRow {
  display: flex !important;
  gap: var(--space-sm);
  justify-content: center;
}

.subscribe-box .ml-form-fieldRow input[type="email"] {
  flex: 1;
  padding: var(--space-md) !important;
  border: 1px solid var(--border) !important;
  font-size: 1rem !important;
}

.subscribe-box .ml-form-fieldRow button,
.subscribe-box .ml-form-embedSubmit button {
  background: #E85D04 !important;
  border: none !important;
  padding: var(--space-md) var(--space-xl) !important;
  font-weight: 600 !important;
  cursor: pointer;
  white-space: nowrap;
}

.subscribe-box .ml-form-fieldRow button:hover,
.subscribe-box .ml-form-embedSubmit button:hover {
  background: #FFD000 !important;
  color: #1a1a1a !important;
}

/* Letters to the Editor */
.letters-box {
  margin-top: var(--space-xl);
  padding: var(--space-lg);
  background: var(--surface);
  border-left: 3px solid #1B3A5F;
}

.letters-box-inner {
  display: flex;
  align-items: flex-start;
  gap: var(--space-lg);
}

.letters-icon {
  font-size: 2rem;
  opacity: 0.6;
}

.letters-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.letters-jp {
  font-family: var(--font-jp);
  font-size: 0.8rem;
  color: #1B3A5F;
  letter-spacing: 0.1em;
}

.letters-title {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 600;
}

.letters-desc {
  font-size: 0.9rem;
  color: var(--text-light);
  margin: var(--space-xs) 0;
  line-height: 1.5;
}

.letters-link {
  font-size: 0.9rem;
  color: #E85D04;
  font-weight: 500;
}

.letters-link:hover {
  color: #FFD000;
}

@media (max-width: 600px) {
  .letters-box-inner {
    flex-direction: column;
    text-align: center;
    align-items: center;
  }
}
</style>

<script>
    (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '2043859');
</script>
{{ end }}
