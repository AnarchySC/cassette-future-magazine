{{ define "main" }}
<!-- Edition Banner - 21:9 Minimal -->
<section class="edition-banner">
  <!-- Left: Title + Headlines -->
  <div class="banner-content">
    <div class="banner-titles">
      <div class="banner-edition">2935.{{ now.YearDay | printf "%03d" }}</div>
      <h1 class="banner-title-main">カセット・フューチャー</h1>
      <div class="banner-subtitle">CASSETTE FUTURE MAGAZINE</div>
    </div>

    <!-- Headlines -->
    <div class="banner-headlines">
      {{ range first 3 (where .Site.RegularPages "Section" "posts") }}
      <a href="{{ .RelPermalink }}" class="banner-headline">{{ .Title }}</a>
      {{ end }}
    </div>
  </div>

  <!-- Right: Cosmogirl preview -->
  {{ with (index (where .Site.RegularPages "Section" "cosmogirls") 0) }}
  <a href="{{ .RelPermalink }}" class="banner-cosmogirl">
    {{ with .Params.featured_image }}
    <img src="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" . }}" alt="Cosmogirl of the Week">
    {{ end }}
    <span class="cosmogirl-label">今週のコスモガール</span>
  </a>
  {{ end }}

  <!-- Footer bar -->
  <div class="banner-footer">
    銀河通信 • CASSETTE FUTURE • 2935.{{ now.YearDay | printf "%03d" }}
  </div>
</section>

  <!-- Cosmogirl of the Week -->
  {{ with (index (where .Site.RegularPages "Section" "cosmogirls") 0) }}
  <section class="cosmogirl-feature-home mt-xl">
    <div class="cosmogirl-feature-grid">
      {{ with .Params.featured_image }}
      <a href="{{ $.RelPermalink }}" class="cosmogirl-feature-image">
        <img src="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" . }}" alt="{{ $.Params.name }}">
      </a>
      {{ end }}
      <div class="cosmogirl-feature-info">
        <div class="jp" style="font-size: 1.2rem; margin-bottom: var(--space-sm);">今週のコスモガール</div>
        <h2><a href="{{ .RelPermalink }}">{{ .Params.name }}</a></h2>
        <div class="cosmogirl-tagline">{{ .Params.species }} • {{ .Params.occupation }}</div>
        <div class="cosmogirl-details">
          <span>{{ .Params.home }}</span>
          <span>{{ .Params.ship_name }}</span>
        </div>
        {{ with .Params.quote }}
        <blockquote class="cosmogirl-mini-quote">"{{ . | truncate 100 }}"</blockquote>
        {{ end }}
        <a href="{{ .RelPermalink }}" class="cosmogirl-link">Full Profile →</a>
      </div>
    </div>
  </section>
  {{ end }}

  <!-- Section Divider -->
  <div class="section-divider">
    <span class="divider-line divider-blue"></span>
    <span class="divider-line divider-orange"></span>
    <span class="divider-line divider-yellow"></span>
  </div>

  <!-- Recent Articles -->
  <section class="mt-xl">
    <h2 class="section-title">最新記事</h2>
    {{ range first 5 (where .Site.RegularPages "Section" "!=" "cosmogirls") }}
      <article class="article-card">
        <div class="article-jp-header">
          {{ .Params.title_jp | default "記事" }}
        </div>
        <div class="article-content">
          <h3 class="article-title">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h3>
          {{ with .Params.subtitle_jp }}
          <div class="article-subtitle">{{ . }}</div>
          {{ end }}
          <p class="article-excerpt">{{ .Summary | truncate 200 }}</p>
        </div>
        <div class="article-meta">
          <div class="article-journalist">{{ .Params.journalist | default "Staff" }}</div>
          <div class="article-date">{{ .Params.year | default "2935" }}.{{ .Date.YearDay | printf "%03d" }}</div>
        </div>
      </article>
    {{ end }}
  </section>

  <!-- Subscribe Box -->
  <section class="subscribe-box">
    <div class="subscribe-box-inner">
      <div class="subscribe-box-text">
        <span class="subscribe-jp">週刊配信</span>
        <span class="subscribe-en">Get weekly transmissions</span>
      </div>
      <div class="subscribe-box-form">
        <div class="ml-embedded" data-form="v4bk2z"></div>
      </div>
    </div>
  </section>

<style>
.subscribe-box {
  margin-top: var(--space-xl);
  padding: var(--space-lg) 0;
  border-top: 2px solid var(--border);
  border-bottom: 2px solid var(--border);
}

.subscribe-box-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-xl);
  flex-wrap: wrap;
}

.subscribe-box-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.subscribe-jp {
  font-family: var(--font-jp);
  font-size: 1.4rem;
  font-weight: 700;
}

.subscribe-en {
  font-size: 0.85rem;
  color: var(--text-light);
}

.subscribe-box-form {
  flex: 1;
  max-width: 400px;
  min-width: 280px;
}

/* Override Mailerlite default styles for inline look */
.subscribe-box .ml-embedded {
  margin: 0;
}

.subscribe-box .ml-form-embedWrapper {
  max-width: 100% !important;
}

.subscribe-box .ml-form-embedBody {
  padding: 0 !important;
}

.subscribe-box .ml-form-fieldRow {
  display: flex !important;
  gap: var(--space-sm);
}

.subscribe-box .ml-form-fieldRow input[type="email"] {
  flex: 1;
  padding: var(--space-sm) var(--space-md) !important;
  border: 1px solid var(--border) !important;
  font-size: 0.9rem !important;
}

.subscribe-box .ml-form-fieldRow button,
.subscribe-box .ml-form-embedSubmit button {
  background: #E85D04 !important;
  border: none !important;
  padding: var(--space-sm) var(--space-lg) !important;
  font-weight: 600 !important;
  cursor: pointer;
  white-space: nowrap;
}

.subscribe-box .ml-form-fieldRow button:hover,
.subscribe-box .ml-form-embedSubmit button:hover {
  background: #FFD000 !important;
  color: #1a1a1a !important;
}

@media (max-width: 600px) {
  .subscribe-box-inner {
    flex-direction: column;
    text-align: center;
  }

  .subscribe-box-form {
    width: 100%;
    max-width: 100%;
  }
}
</style>

<script>
    (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '2043859');
</script>
{{ end }}
